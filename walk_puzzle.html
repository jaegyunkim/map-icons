<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì›Œí‚¹ ì±Œë¦°ì§€ í¼ì¦</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap');
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            touch-action: manipulation; /* ëª¨ë°”ì¼ì—ì„œ ë”ë¸”íƒ­ ì¤Œ ë°©ì§€ */
        }

        .puzzle-board {
            position: relative;
            width: 100%;
            max-width: 400px; /* ìµœëŒ€ í¬ê¸° ì œí•œ */
            aspect-ratio: 1 / 1;
            background-color: #f3f4f6;
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .tile {
            position: absolute;
            width: 33.333%;
            height: 33.333%;
            transition: top 0.2s ease-in-out, left 0.2s ease-in-out;
            cursor: pointer;
            box-sizing: border-box;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background-size: 300% 300%; /* 3x3 ê·¸ë¦¬ë“œì´ë¯€ë¡œ 300% */
            z-index: 10;
        }

        .tile:hover {
            filter: brightness(1.1);
            z-index: 20;
        }

        /* ì„±ê³µ ì‹œ ì˜¤ë²„ë ˆì´ ì• ë‹ˆë©”ì´ì…˜ */
        .fade-in {
            animation: fadeIn 0.5s forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .btn {
            transition: transform 0.1s;
        }
        .btn:active {
            transform: scale(0.95);
        }
        
        /* ë©”ì‹œì§€ ì• ë‹ˆë©”ì´ì…˜ */
        .pulse-text {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center p-4">

    <!-- ê²Œì„ ì»¨í…Œì´ë„ˆ -->
    <div class="w-full max-w-md bg-white rounded-2xl shadow-xl p-6 flex flex-col items-center space-y-4">
        
        <!-- í—¤ë” -->
        <div class="text-center w-full">
            <div class="flex justify-between items-center mb-2">
                <span id="stage-badge" class="bg-blue-100 text-blue-800 text-sm font-medium px-2.5 py-0.5 rounded border border-blue-400">
                    STAGE <span id="current-stage-num">1</span>
                </span>
                <div class="flex items-center gap-2">
                    <button onclick="solveGame()" class="bg-yellow-100 hover:bg-yellow-200 text-yellow-800 text-xs font-bold px-2 py-1 rounded border border-yellow-300 transition-colors">
                        íŒíŠ¸
                    </button>
                    <button onclick="toggleHelp()" class="text-gray-500 hover:text-gray-700">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </button>
                </div>
            </div>
            <h1 class="text-2xl font-bold text-gray-800 mb-1">í¼ì¦ì„ ì™„ì„±í•˜ì„¸ìš”</h1>
            <p class="text-xs text-gray-500">ë¹ˆ ì¹¸ ì£¼ë³€ì˜ íƒ€ì¼ì„ í´ë¦­í•˜ì—¬ ì´ë™ì‹œí‚¤ì„¸ìš”.</p>
        </div>

        <!-- í¼ì¦ ì˜ì—­ -->
        <div id="game-container" class="puzzle-board border-4 border-gray-800 relative">
            <!-- íƒ€ì¼ë“¤ì´ JSë¡œ ìƒì„±ë¨ -->
            <div id="tiles-wrapper" class="w-full h-full relative"></div>

            <!-- ì„±ê³µ ì˜¤ë²„ë ˆì´ (ë§ˆì§€ë§‰ ë‹¨ê³„ìš©) -->
            <div id="success-overlay" class="absolute inset-0 bg-black bg-opacity-70 flex flex-col items-center justify-center hidden z-50 backdrop-blur-sm">
                <div class="text-white text-3xl font-bold mb-4 animate-bounce">ì™„ì„±! ğŸ‰</div>
                
                <!-- ë‹¨ê³„ë³„ ë²„íŠ¼ (ë§ˆì§€ë§‰ ë‹¨ê³„ë§Œ ì‚¬ìš©) -->
                <div id="controls-area" class="flex flex-col gap-3 w-3/4">
                    <button id="restart-btn" onclick="resetGame()" class="btn hidden w-full bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg shadow-lg">
                        ì²˜ìŒë¶€í„° ë‹¤ì‹œí•˜ê¸°
                    </button>
                    <button id="more-info-btn" onclick="goToMoreInfo()" class="btn hidden w-full bg-yellow-400 hover:bg-yellow-500 text-gray-900 font-bold py-3 px-4 rounded-lg shadow-lg border border-yellow-500">
                        ë” ë§ì€ ì •ë³´ë³´ê¸°
                    </button>
                </div>
            </div>
        </div>

        <!-- ì›ë³¸ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° ë° ìƒíƒœ ë©”ì‹œì§€ ì˜ì—­ -->
        <div class="w-full flex justify-center mt-4 h-28 items-center"> <!-- ë†’ì´ ê³ ì •ìœ¼ë¡œ ë ˆì´ì•„ì›ƒ í”ë“¤ë¦¼ ë°©ì§€ -->
            <div class="text-center w-full" id="preview-area">
                <!-- ì´ë¯¸ì§€ ëª¨ë“œ -->
                <div id="preview-content">
                    <p class="text-xs text-gray-400 mb-1">ëª©í‘œ ì´ë¯¸ì§€</p>
                    <img id="preview-img" src="" alt="Preview" class="w-24 h-24 object-cover rounded border border-gray-300 shadow-sm opacity-80 mx-auto">
                </div>

                <!-- ë©”ì‹œì§€ ëª¨ë“œ (ì„±ê³µ ì‹œ í‘œì‹œ) -->
                <div id="stage-msg" class="hidden flex flex-col items-center justify-center h-full">
                    <p class="text-xl font-bold text-blue-600 mb-2">ì™„ì„±! ğŸ‰</p>
                    <p class="text-gray-600 font-medium pulse-text">
                        <span id="countdown-timer" class="text-2xl font-bold text-blue-500">5</span>ì´ˆ í›„ì—<br>ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™í•©ë‹ˆë‹¤
                    </p>
                </div>
            </div>
        </div>

    </div>

    <!-- ë„ì›€ë§ ëª¨ë‹¬ -->
    <div id="help-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4" onclick="toggleHelp()">
        <div class="bg-white rounded-lg p-6 max-w-sm w-full" onclick="event.stopPropagation()">
            <h3 class="text-lg font-bold mb-2">ê²Œì„ ë°©ë²•</h3>
            <ul class="list-disc list-inside text-sm text-gray-600 space-y-1">
                <li>ì´ 6ë‹¨ê³„ì˜ ìŠ¤í…Œì´ì§€ê°€ ìˆìŠµë‹ˆë‹¤.</li>
                <li>ë¹ˆ ì¹¸(íšŒìƒ‰) ì˜†ì˜ íƒ€ì¼ì„ í´ë¦­í•˜ë©´ ì´ë™í•©ë‹ˆë‹¤.</li>
                <li>ê·¸ë¦¼ì„ ì›ë˜ëŒ€ë¡œ ë§ì¶”ë©´ ë‹¤ìŒ ë‹¨ê³„ë¡œ ë„˜ì–´ê°ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
            </ul>
            <button onclick="toggleHelp()" class="mt-4 w-full bg-gray-200 hover:bg-gray-300 py-2 rounded text-sm font-bold text-gray-700">ë‹«ê¸°</button>
        </div>
    </div>

    <script>
        // ê²Œì„ ì„¤ì • ë°ì´í„°
        const stages = [
            "https://jaegyunkim.github.io/map-icons/walk_1.png",
            "https://jaegyunkim.github.io/map-icons/walk_2.png",
            "https://jaegyunkim.github.io/map-icons/walk_3.png",
            "https://jaegyunkim.github.io/map-icons/walk_4.png",
            "https://jaegyunkim.github.io/map-icons/walk_5.png",
            "https://jaegyunkim.github.io/map-icons/walk_main.png"
        ];

        let currentStageIndex = 0;
        const gridSize = 3; // 3x3
        let tiles = []; // í˜„ì¬ íƒ€ì¼ ìƒíƒœ ë°°ì—´
        let emptyPos = { row: 2, col: 2 }; // ë¹ˆ ì¹¸ì˜ ìœ„ì¹˜
        let isSolved = false;
        let autoMoveTimer = null; // ìë™ ì´ë™ íƒ€ì´ë¨¸
        let countdownInterval = null; // ì¹´ìš´íŠ¸ë‹¤ìš´ ì¸í„°ë²Œ

        // DOM ìš”ì†Œ
        const tilesWrapper = document.getElementById('tiles-wrapper');
        const successOverlay = document.getElementById('success-overlay');
        const restartBtn = document.getElementById('restart-btn');
        const moreInfoBtn = document.getElementById('more-info-btn');
        const stageNumDisplay = document.getElementById('current-stage-num');
        const previewImg = document.getElementById('preview-img');
        
        // ë¯¸ë¦¬ë³´ê¸° ì˜ì—­ ìš”ì†Œ
        const previewContent = document.getElementById('preview-content');
        const stageMsg = document.getElementById('stage-msg');
        const countdownTimer = document.getElementById('countdown-timer');

        // ê²Œì„ ì´ˆê¸°í™”
        function initGame() {
            // íƒ€ì´ë¨¸ ì •ë¦¬
            if (autoMoveTimer) clearTimeout(autoMoveTimer);
            if (countdownInterval) clearInterval(countdownInterval);
            
            isSolved = false;
            successOverlay.classList.add('hidden');
            
            // ë¯¸ë¦¬ë³´ê¸° ì˜ì—­ ì´ˆê¸°í™” (ì´ë¯¸ì§€ ë³´ì´ê¸°, ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°)
            previewContent.classList.remove('hidden');
            stageMsg.classList.add('hidden');

            stageNumDisplay.textContent = currentStageIndex + 1;
            previewImg.src = stages[currentStageIndex];
            
            // íƒ€ì¼ ìƒì„± ë° ì´ˆê¸°í™” (ì •ë‹µ ìƒíƒœ)
            tiles = [];
            tilesWrapper.innerHTML = '';
            
            const tileSize = 100 / gridSize; // í¼ì„¼íŠ¸ ë‹¨ìœ„ í¬ê¸°

            for (let row = 0; row < gridSize; row++) {
                for (let col = 0; col < gridSize; col++) {
                    // ë§ˆì§€ë§‰ ì¹¸ì€ ë¹ˆ ì¹¸ìœ¼ë¡œ ì„¤ì •
                    if (row === gridSize - 1 && col === gridSize - 1) {
                        emptyPos = { row, col };
                        continue;
                    }

                    const tile = document.createElement('div');
                    tile.className = 'tile';
                    
                    // ë°°ê²½ ì´ë¯¸ì§€ ì„¤ì •
                    tile.style.backgroundImage = `url('${stages[currentStageIndex]}')`;
                    
                    // ë°°ê²½ ìœ„ì¹˜ ê³„ì‚°
                    const bgX = col * (100 / (gridSize - 1));
                    const bgY = row * (100 / (gridSize - 1));
                    tile.style.backgroundPosition = `${bgX}% ${bgY}%`;
                    
                    // íƒ€ì¼ì˜ í˜„ì¬ ìœ„ì¹˜ (ì´ˆê¸°ì—ëŠ” ì •ë‹µ ìœ„ì¹˜)
                    tile.style.top = `${row * tileSize}%`;
                    tile.style.left = `${col * tileSize}%`;
                    
                    // ë°ì´í„° ì €ì¥
                    tile.dataset.row = row;
                    tile.dataset.col = col;
                    tile.dataset.correctRow = row; // ì •ë‹µ ìœ„ì¹˜ í™•ì¸ìš©
                    tile.dataset.correctCol = col;
                    
                    // í´ë¦­ ì´ë²¤íŠ¸
                    tile.onclick = () => moveTile(tile);

                    tilesWrapper.appendChild(tile);
                    tiles.push(tile);
                }
            }

            // ì…”í”Œ (ë¬´ì‘ìœ„ë¡œ ì„ë˜, í’€ ìˆ˜ ìˆëŠ” ìƒíƒœ ìœ ì§€)
            shuffleTiles();
        }

        // íƒ€ì¼ ì„ê¸°
        function shuffleTiles() {
            const moves = 100;
            let lastMovedTile = null;

            for (let i = 0; i < moves; i++) {
                const neighbors = getMovableNeighbors();
                const candidates = neighbors.filter(t => t !== lastMovedTile);
                
                const tileToMove = candidates.length > 0 
                    ? candidates[Math.floor(Math.random() * candidates.length)] 
                    : neighbors[Math.floor(Math.random() * neighbors.length)];

                if (tileToMove) {
                    swapTilePosition(tileToMove, false);
                    lastMovedTile = tileToMove;
                }
            }
        }

        // ì´ë™ ê°€ëŠ¥í•œ íƒ€ì¼ ì°¾ê¸°
        function getMovableNeighbors() {
            return tiles.filter(tile => {
                const r = parseInt(tile.dataset.row);
                const c = parseInt(tile.dataset.col);
                const distance = Math.abs(r - emptyPos.row) + Math.abs(c - emptyPos.col);
                return distance === 1; // ìƒí•˜ì¢Œìš° ì¸ì ‘í•œ íƒ€ì¼
            });
        }

        // íƒ€ì¼ ì´ë™ ë¡œì§
        function moveTile(tile) {
            if (isSolved) return;

            const r = parseInt(tile.dataset.row);
            const c = parseInt(tile.dataset.col);

            // ë¹ˆ ì¹¸ê³¼ ì¸ì ‘í•œì§€ í™•ì¸ (ìƒí•˜ì¢Œìš° ê±°ë¦¬ í•©ì´ 1ì´ì–´ì•¼ í•¨)
            if (Math.abs(r - emptyPos.row) + Math.abs(c - emptyPos.col) === 1) {
                swapTilePosition(tile, true);
            }
        }

        // ìœ„ì¹˜ êµí™˜ ìˆ˜í–‰
        function swapTilePosition(tile, checkWinCondition = true) {
            const currentR = parseInt(tile.dataset.row);
            const currentC = parseInt(tile.dataset.col);
            
            // ë¹ˆ ì¹¸ ì¢Œí‘œ ì„ì‹œ ì €ì¥
            const newR = emptyPos.row;
            const newC = emptyPos.col;
            
            const tileSize = 100 / gridSize;

            // DOM ë° ë°ì´í„° ì—…ë°ì´íŠ¸
            tile.style.top = `${newR * tileSize}%`;
            tile.style.left = `${newC * tileSize}%`;
            tile.dataset.row = newR;
            tile.dataset.col = newC;

            // ë¹ˆ ì¹¸ ì¢Œí‘œ ê°±ì‹ 
            emptyPos.row = currentR;
            emptyPos.col = currentC;

            if (checkWinCondition) {
                checkWin();
            }
        }

        // ìŠ¹ë¦¬ ì¡°ê±´ í™•ì¸
        function checkWin() {
            let correctCount = 0;
            
            tiles.forEach(tile => {
                const r = parseInt(tile.dataset.row);
                const c = parseInt(tile.dataset.col);
                const cr = parseInt(tile.dataset.correctRow);
                const cc = parseInt(tile.dataset.correctCol);

                if (r === cr && c === cc) {
                    correctCount++;
                }
            });

            // ëª¨ë“  íƒ€ì¼ì´ ì œìë¦¬ì— ìˆìœ¼ë©´ ì„±ê³µ
            if (correctCount === (gridSize * gridSize) - 1) {
                isSolved = true;
                showSuccessScreen();
            }
        }

        // ì„±ê³µ í™”ë©´ í‘œì‹œ
        function showSuccessScreen() {
            
            // [ì¶”ê°€ëœ ê¸°ëŠ¥] ë¹ˆ ì¹¸ ì±„ìš°ê¸° (ì™„ì„±ëœ ì´ë¯¸ì§€ ë³´ì—¬ì£¼ê¸°)
            if (!document.getElementById('completed-piece')) {
                const tileSize = 100 / gridSize;
                const completedTile = document.createElement('div');
                completedTile.id = 'completed-piece';
                completedTile.className = 'tile';
                completedTile.style.backgroundImage = `url('${stages[currentStageIndex]}')`;
                completedTile.style.backgroundPosition = '100% 100%'; // ë§ˆì§€ë§‰ ì¹¸ (ìš°ì¸¡ í•˜ë‹¨) ì´ë¯¸ì§€ ì¢Œí‘œ
                completedTile.style.top = `${(gridSize - 1) * tileSize}%`;
                completedTile.style.left = `${(gridSize - 1) * tileSize}%`;
                completedTile.style.cursor = 'default';
                completedTile.style.opacity = '0'; // í˜ì´ë“œì¸ ì‹œì‘ê°’
                completedTile.style.transition = 'opacity 0.5s ease-in-out';
                completedTile.style.zIndex = '5'; // ê¸°ì¡´ íƒ€ì¼ê³¼ ë ˆë²¨ ë§ì¶¤
                
                tilesWrapper.appendChild(completedTile);
                
                // ì• ë‹ˆë©”ì´ì…˜ ì‹¤í–‰
                setTimeout(() => {
                    completedTile.style.opacity = '1';
                }, 50);
            }

            if (currentStageIndex < stages.length - 1) {
                // [1~5 ë‹¨ê³„]
                // 1. ë¸”ëŸ¬ ì˜¤ë²„ë ˆì´ëŠ” í‘œì‹œí•˜ì§€ ì•ŠìŒ (í¼ì¦ ì´ë¯¸ì§€ ê·¸ëŒ€ë¡œ ë…¸ì¶œ)
                
                // 2. ë¯¸ë¦¬ë³´ê¸° ì˜ì—­ì„ ë©”ì‹œì§€ ì˜ì—­ìœ¼ë¡œ êµì²´
                previewContent.classList.add('hidden');
                stageMsg.classList.remove('hidden');

                // 3. 5ì´ˆ ì¹´ìš´íŠ¸ë‹¤ìš´ ì‹œì‘
                let timeLeft = 5;
                countdownTimer.textContent = timeLeft;
                
                countdownInterval = setInterval(() => {
                    timeLeft--;
                    if(timeLeft > 0) {
                        countdownTimer.textContent = timeLeft;
                    } else {
                        clearInterval(countdownInterval);
                    }
                }, 1000);

                // 4. 5ì´ˆ í›„ ë‹¤ìŒ ë‹¨ê³„ í•¨ìˆ˜ ì‹¤í–‰
                autoMoveTimer = setTimeout(() => {
                    nextStage();
                }, 5000);
                
            } else {
                // [6ë‹¨ê³„ (ë§ˆì§€ë§‰)]
                // ê¸°ì¡´ì²˜ëŸ¼ ì˜¤ë²„ë ˆì´ì™€ ë²„íŠ¼ í‘œì‹œ
                successOverlay.classList.remove('hidden');
                successOverlay.classList.add('fade-in');

                restartBtn.classList.remove('hidden');
                moreInfoBtn.classList.remove('hidden');
            }
        }

        // ë‹¤ìŒ ë‹¨ê³„
        function nextStage() {
            if (currentStageIndex < stages.length - 1) {
                currentStageIndex++;
                initGame();
            }
        }

        // ë‹¤ì‹œ í•˜ê¸° (1ë‹¨ê³„ë¡œ)
        function resetGame() {
            currentStageIndex = 0;
            initGame();
        }

        // ë” ë§ì€ ì •ë³´ ë³´ê¸°
        function goToMoreInfo() {
            window.location.href = 'https://m.blog.naver.com/thedailypick';
        }
        
        // ë„ì›€ë§ í† ê¸€
        function toggleHelp() {
            const modal = document.getElementById('help-modal');
            modal.classList.toggle('hidden');
        }

        // íŒíŠ¸ ê¸°ëŠ¥ (í¼ì¦ ìë™ ì™„ì„±)
        function solveGame() {
            if (isSolved) return;

            tiles.forEach(tile => {
                const correctR = parseInt(tile.dataset.correctRow);
                const correctC = parseInt(tile.dataset.correctCol);
                const tileSize = 100 / gridSize;
                
                // ë°ì´í„° ì—…ë°ì´íŠ¸
                tile.dataset.row = correctR;
                tile.dataset.col = correctC;
                
                // ì‹œê°ì  ìœ„ì¹˜ ì—…ë°ì´íŠ¸
                tile.style.top = `${correctR * tileSize}%`;
                tile.style.left = `${correctC * tileSize}%`;
            });

            // ë¹ˆ ì¹¸ ìœ„ì¹˜ë¥¼ ë§ˆì§€ë§‰(2,2)ìœ¼ë¡œ ì¬ì„¤ì •
            emptyPos = { row: gridSize - 1, col: gridSize - 1 };

            // ìŠ¹ë¦¬ ì²´í¬ (ì¦‰ì‹œ ì™„ë£Œ ì²˜ë¦¬)
            checkWin();
        }

        // ì•± ì‹œì‘
        window.onload = initGame;

    </script>
</body>
</html>